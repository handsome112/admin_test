{"ast":null,"code":"var _jsxFileName = \"/var/www/admin.dtest.live/src/components/file/image-upload.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Upload, message } from 'antd';\nimport { LoadingOutlined, PlusOutlined } from '@ant-design/icons';\nimport { PureComponent } from 'react';\n\nfunction getBase64(img, callback) {\n  const reader = new FileReader();\n  reader.addEventListener('load', () => callback(reader.result));\n  reader.readAsDataURL(img);\n}\n\nfunction beforeUpload(file) {\n  const ext = file.name.split('.').pop().toLowerCase();\n  const isImageAccept = process.env.NEXT_PUBLIC_IMAGE_ACCPET.split(',').map(item => item.trim()).indexOf(`.${ext}`);\n\n  if (isImageAccept === -1) {\n    message.error(`You can only upload ${process.env.NEXT_PUBLIC_IMAGE_ACCPET} file!`);\n  }\n\n  const isLt2M = file.size / 1024 / 1024 < (process.env.NEXT_PUBLIC_MAXIMUM_SIZE_UPLOAD_IMAGE || 2);\n\n  if (!isLt2M) {\n    message.error(`Image must smaller than ${process.env.NEXT_PUBLIC_MAXIMUM_SIZE_UPLOAD_IMAGE || 2}MB!`);\n  }\n\n  return isImageAccept > -1 && isLt2M;\n}\n\nexport class ImageUpload extends PureComponent {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      loading: false,\n      imageUrl: this.props.imageUrl\n    });\n\n    _defineProperty(this, \"handleChange\", info => {\n      if (info.file.status === 'uploading') {\n        this.setState({\n          loading: true\n        });\n        return;\n      }\n\n      if (info.file.status === 'done') {\n        // Get this url from response in real world.\n        getBase64(info.file.originFileObj, imageUrl => {\n          this.setState({\n            imageUrl,\n            loading: false\n          });\n          this.props.onUploaded && this.props.onUploaded({\n            response: info.file.response,\n            base64: imageUrl\n          });\n        });\n      }\n    });\n  }\n\n  render() {\n    const {\n      options = {}\n    } = this.props;\n\n    const uploadButton = __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 7\n      }\n    }, this.state.loading ? __jsx(LoadingOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 31\n      }\n    }) : __jsx(PlusOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 53\n      }\n    }), __jsx(\"div\", {\n      className: \"ant-upload-text\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 9\n      }\n    }, \"Upload\"));\n\n    const {\n      imageUrl\n    } = this.state;\n    const {\n      headers,\n      uploadUrl\n    } = this.props;\n    return __jsx(Upload, {\n      name: options.fieldName || 'file',\n      listType: \"picture-card\",\n      className: \"avatar-uploader\",\n      showUploadList: false,\n      action: uploadUrl,\n      beforeUpload: beforeUpload,\n      onChange: this.handleChange,\n      headers: headers,\n      accept: process.env.NEXT_PUBLIC_IMAGE_ACCPET,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 7\n      }\n    }, imageUrl ? __jsx(\"img\", {\n      src: imageUrl,\n      alt: \"file\",\n      style: {\n        width: '100%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 11\n      }\n    }) : uploadButton);\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}